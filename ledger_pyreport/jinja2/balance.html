{#
    ledger-pyreport
    Copyright Â© 2020  Lee Yingtong Li (RunasSudo)
 
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
 
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.
 
    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
#}

{% macro do_account(account, acc_level=0, disp_level=0, invert=False) %}
	<tr>
		<td style="padding-left: calc(2px + {{ disp_level }}em);">{{ ':'.join(account.name_parts[acc_level+1:]) }}</td>
		<td>{% if account.balance != 0 %}{{ (account.balance * (-1 if invert else 1))|a }}{% endif %}</td>
	</tr>
	{{ walk_children(account.children, acc_level + 1, disp_level + 1, invert) }}
{% endmacro %}

{% macro walk_children(children, acc_level=0, disp_level=0, invert=False) %}
	{% for account in children %}
		{{ do_account(account, acc_level, disp_level, invert) }}
	{% endfor %}
{% endmacro %}

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Balance Sheet as at {{ date.strftime('%d %B %Y') }}</title>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}">
	</head>
	<body>
		<h1>Balance Sheet</h1>
		<h2>As at {{ date.strftime('%d %B %Y') }}</h2>
		
		<table class="ledger two-amounts">
			<tr><th class="h1" colspan="2">Assets</th></tr>
			
			{% for asset_class in assets.children %}
				<tr><th class="h2" colspan="2">{{ asset_class.name_parts[-1] }} Assets</th></tr>
				{{ walk_children(asset_class.children, acc_level=1) }}
				<tr class="total">
					<td>Total {{ asset_class.name_parts[-1] }} Assets</td>
					<td>{{ asset_class.total()|a }}</td>
				</tr>
				<tr><td colspan="2">&nbsp;</td></tr>
			{% endfor %}
			
			<tr class="total">
				<td>Total Assets</td>
				<td>{{ assets.total()|a }}</td>
			</tr>
			<tr><td colspan="2">&nbsp;</td></tr>
			
			{% if not cash %}
				<tr><th class="h1" colspan="2">Liabilities</th></tr>
				
				{% for liability_class in liabilities.children %}
					<tr><th class="h2" colspan="2">{{ liability_class.name_parts[-1] }} Liabilities</th></tr>
					{{ walk_children(liability_class.children, acc_level=1, invert=True) }}
					<tr class="total">
						<td>Total {{ liability_class.name_parts[-1] }} Liabilities</td>
						<td>{{ -liability_class.total()|a }}</td>
					</tr>
					<tr><td colspan="2">&nbsp;</td></tr>
				{% endfor %}
				
				<tr class="total">
					<td>Total Liabilities</td>
					<td>{{ -liabilities.total()|a }}</td>
				</tr>
				<tr class="total">
					<td>Net Assets</td>
					<td>{{ (assets.total() + liabilities.total())|a }}</td>
				</tr>
				<tr><td colspan="2">&nbsp;</td></tr>
			{% endif %}
			
			<tr><th class="h1" colspan="2">Equity</th></tr>
			
			{{ walk_children(equity.children, invert=True) }}
			<tr class="total">
				<td>Total Equity</td>
				<td>{{ -equity.total()|a }}</td>
			</tr>
		</table>
	</body>
</html>
